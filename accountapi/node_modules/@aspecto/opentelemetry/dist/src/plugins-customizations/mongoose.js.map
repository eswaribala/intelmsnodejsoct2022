{"version":3,"file":"mongoose.js","sourceRoot":"","sources":["../../../src/plugins-customizations/mongoose.ts"],"names":[],"mappings":";;;AAOA,oEAAoE;AACpE,qDAA0D;AAE1D,MAAM,OAAO,GAAG,CAAC,GAAQ,EAAE,EAAE,CAAC,CAAC,GAAG,IAAI,CAAC,OAAO,GAAG,KAAK,QAAQ,IAAI,MAAM,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,MAAM,KAAK,CAAC,CAAC,CAAC;AAEjG,MAAM,qBAAqB,GAA0B,CAAC,GAAW,EAAE,OAA0B,EAAE,EAAE;IAC7F,IAAI;QACA,IAAI,OAAO,CAAC,OAAO,CAAC,OAAO,CAAC;YAAE,OAAO,OAAO,CAAC,OAAO,CAAC;QACrD,OAAO,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,CAAC;KAClC;IAAC,WAAM;QACJ,OAAO,SAAS,CAAC;KACpB;AACL,CAAC,CAAC;AAEF,MAAM,YAAY,GAA6C,CAAC,IAAU,EAAE,QAAa,EAAE,EAAE;IACzF,IAAI,CAAC,YAAY,CAAC,0CAAqB,CAAC,WAAW,EAAE,IAAI,CAAC,SAAS,CAAC,QAAQ,CAAC,CAAC,CAAC;AACnF,CAAC,CAAC;AAEW,QAAA,2BAA2B,GAAkC;IACtE,+BAA+B,EAAE,IAAI;IACrC,YAAY,EAAE,uCAAsB,CAAC,YAAY,CAAC;IAClD,qBAAqB;IACrB,0BAA0B,EAAE,0CAAqB,CAAC,cAAc;CACnE,CAAC","sourcesContent":["import { Span } from '@opentelemetry/sdk-trace-base';\nimport {\n    MongooseInstrumentationConfig,\n    SerializerPayload,\n    MongooseResponseCustomAttributesFunction,\n    DbStatementSerializer,\n} from 'opentelemetry-instrumentation-mongoose';\nimport { AspectoAttributeNames } from '@aspecto/opentelemetry-base';\nimport { callCapturePayloadHook } from './recording-span';\n\nconst isEmpty = (obj: any) => !obj || (typeof obj === 'object' && Object.keys(obj).length === 0);\n\nconst dbStatementSerializer: DbStatementSerializer = (_op: string, payload: SerializerPayload) => {\n    try {\n        if (isEmpty(payload.options)) delete payload.options;\n        return JSON.stringify(payload);\n    } catch {\n        return undefined;\n    }\n};\n\nconst responseHook: MongooseResponseCustomAttributesFunction = (span: Span, response: any) => {\n    span.setAttribute(AspectoAttributeNames.DB_RESPONSE, JSON.stringify(response));\n};\n\nexport const aspectoMongoosePluginConfig: MongooseInstrumentationConfig = {\n    suppressInternalInstrumentation: true,\n    responseHook: callCapturePayloadHook(responseHook),\n    dbStatementSerializer,\n    moduleVersionAttributeName: AspectoAttributeNames.MODULE_VERSION,\n};\n"]}