"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.aspectoMongoosePluginConfig = void 0;
const opentelemetry_base_1 = require("@aspecto/opentelemetry-base");
const recording_span_1 = require("./recording-span");
const isEmpty = (obj) => !obj || (typeof obj === 'object' && Object.keys(obj).length === 0);
const dbStatementSerializer = (_op, payload) => {
    try {
        if (isEmpty(payload.options))
            delete payload.options;
        return JSON.stringify(payload);
    }
    catch (_a) {
        return undefined;
    }
};
const responseHook = (span, response) => {
    span.setAttribute(opentelemetry_base_1.AspectoAttributeNames.DB_RESPONSE, JSON.stringify(response));
};
exports.aspectoMongoosePluginConfig = {
    suppressInternalInstrumentation: true,
    responseHook: recording_span_1.callCapturePayloadHook(responseHook),
    dbStatementSerializer,
    moduleVersionAttributeName: opentelemetry_base_1.AspectoAttributeNames.MODULE_VERSION,
};
//# sourceMappingURL=mongoose.js.map